<p id="notice"><%= notice %></p>

<% g_user = User.find(@cross.user_id) %>

<%= form_for :cross, :url => {:action => "create"}, :method => "post" do |f| %>
<div class="panel">
\[\underbrace{

&#x2642; \quad 

<% semikolon = 0 %>
<% @parent_male.each do |chr| %>
		<% if chr.size > 1 %>
			<% if semikolon != 0 %>;<% end %>
			<% chr %>
			\dfrac
			<% chr.each do |n| %>
				{<%= n %>}
			<% end %>
		<% else %>
			<% if semikolon != 0 %>;<% end %>
			<% chr.each do |n| %>
				<%= n %>
			<% end %>
		<% end %> 
		<% semikolon = 1 %>
	<% end %> 

\qquad X \qquad 

<% semikolon = 0 %>
<% @parent_female.each do |chr| %>
		<% if chr.size > 1 %>
			<% if semikolon != 0 %>;<% end %>
			<% chr %>
			\dfrac
			<% chr.each do |n| %>
				{<%= n %>}
			<% end %>
		<% else %>
			<% if semikolon != 0 %>;<% end %>
			<% chr.each do |n| %>
				<%= n %>
			<% end %>
		<% end %> 
		<% semikolon = 1 %>
	<% end %>
\quad &#x2640;
}\]

<div align="center">
<% counter = 0 %>
<% @progeny.each do |p| %>
	<% semikolon = 0 %>

<% #Check for lethal and balancers %>
<% death = 0 %>
	<% p.each do |chr| %>
		<% if chr.size == 1 %>
			<% chr.each do |n| %>
				<% @balancers.each do |b| %>
					<% if n == b %>
						<% death = 1 %>
					<% end %>
				<% end %>
				<% @lethal.each do |l| %>
					<% if n == l %>
						<% death = 1 %>
					<% end %>
				<% end %>
			<% end %>
		<% end %>
	<% end %>

	<% if death == 1 %>
		<a class="button small disabled alert">
	<% else %>
		<a class="button small secondary">
	<% end %>

		\[
	<% p.each do |chr| %>
		<% if chr.size > 1 %>
			<% if semikolon != 0 %>;<% end %>
			\dfrac
			<% chr.each do |n| %>
				{<%= n %>}
			<% end %>
		<% else %>
			<% if semikolon != 0 %>;<% end %>
			<% chr.each do |n| %>
				<%= n %>
			<% end %>
		<% end %> 
		<% semikolon = 1 %>
	<% end %>
	\]

<% if death != 1 %>
<% 
if user_signed_in?
if g_user.id == current_user.id
	%>
&#x2642;
<%= f.radio_button(:male_id, @prog_id[counter]) %>
 | &#x2640;
<%= f.radio_button(:female_id, @prog_id[counter]) %>
<% end 
end %>
<% else %>
<i class="fi-skull size-21"></i>
<% end %>

</a>
	<% counter = counter + 1 %>
<% end %>
</div>
</div>

<p>
<a href="mailto:<%= g_user.email %>" alt="<%= g_user.email %>" title="<%= g_user.email %>">
<%= image_tag g_user.gravatar_url %>
</a>

<% if user_signed_in?
if g_user.id == current_user.id %>
<%= link_to @cross, method: :delete, data: { confirm: "Are you sure? The cross and all it's derivatives would be deleted." }, :class => "button alert small" do %>
	<i class="fi-trash size-21" ></i>
<% end %> 
<% end 
end%>

</p>

<% 
if user_signed_in?
if g_user.id == current_user.id
	%>
<h3>Next cross</h3>
<div class="panel">
<%= f.hidden_field(:balancers, :value => @balancer_string) %>
<%= f.hidden_field(:lethal, :value => @lethal_string) %>
<%= f.hidden_field(:parent, :value => @cross.id) %>
<%= f.hidden_field(:link, :value => @random_string) %>

<p>
<a href="#" data-reveal-id="newfly">Add new fly to cross</a>
<div id="newfly" class="reveal-modal" data-reveal>

<div class="panel">
  <h5>Genotype</h5>
&#x2642;
<%= f.radio_button(:male_id, "new") %>
 | &#x2640;
<%= f.radio_button(:female_id, "new") %>  
    <div class="row">
      <div class="large-6 columns">
        <label>X chromosome
          <%= f.text_field :X, :value => "+/+" %>
        </label>
      </div>
      <div class="large-6 columns">
        <label>Chromosome 2
          <%= f.text_field :II, :value => "+/+" %>
        </label>
      </div>
      <div class="large-6 columns">
        <label>Chromosome 3
          <%= f.text_field :III, :value => "+/+" %>
        </label>
      </div>
      <div class="large-6 columns">
        <label>Chromosome 4
          <%= f.text_field :IV, :value => "+/+" %>
          </label>
      </div>
    </div>
</div>

<div class="panel">
  <h5>Lethal alleles</h5>
        <label>Alleles separated by comma
          <%= f.text_field :lethal %>
        </label>
  <h5>Balancers</h5>
        <label>Balancers separated by comma
          <%= f.text_field :balancers %>
        </label>
  <h5>Comments</h5>
        <label>Describe this cross
          <%= f.text_field :description %>
        </label>       
</div>

<a class="close-reveal-modal">&#215;</a>
</div>
</p>

<%= f.submit %>
</div>
<% end %>

<%= image_tag @qr %> 
<% end 
end%>

<script>
 $(document).foundation();
</script>